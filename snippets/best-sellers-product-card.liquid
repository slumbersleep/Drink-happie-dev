{%- comment -%}
  Best Sellers Product Card
  
  Accepts:
  - product: Product object
  - index: Position in grid
  - section: Section object for settings
{%- endcomment -%}

{%- liquid
  # Find the lowest price across all variants
  assign lowest_price = product.price_min
  
  # Check for badge
  assign badge_text = ''
  for block in section.blocks
    if block.type == 'product_badge' and block.settings.product == product
      assign badge_text = block.settings.badge_text
      break
    endif
  endfor
-%}

<div class="best-sellers__card" data-product-id="{{ product.id }}">
  <a href="{{ product.url }}" class="best-sellers__card-image">
    {%- if badge_text != blank -%}
      <span class="best-sellers__badge">{{ badge_text }}</span>
    {%- endif -%}
    
    {%- if product.featured_image != blank -%}
      <img
        src="{{ product.featured_image | image_url: width: 800 }}"
        alt="{{ product.featured_image.alt | escape | default: product.title }}"
        width="{{ product.featured_image.width }}"
        height="{{ product.featured_image.height }}"
        loading="lazy"
      >
    {%- else -%}
      <div class="best-sellers__placeholder-image">
        <span>{{ product.title }}</span>
      </div>
    {%- endif -%}
  </a>
  
  <div class="best-sellers__card-content">
    <a href="{{ product.url }}" class="best-sellers__product-link">
      <h3 class="best-sellers__product-title">{{ product.title }}</h3>
    </a>
    
    {%- if product.metafields.custom.subheading != blank -%}
      <p class="best-sellers__product-desc">{{ product.metafields.custom.subheading }}</p>
    {%- elsif product.metafields.descriptors.subtitle != blank -%}
      <p class="best-sellers__product-desc">{{ product.metafields.descriptors.subtitle.value }}</p>
    {%- elsif product.description != blank -%}
      <p class="best-sellers__product-desc">{{ product.description | strip_html | truncate: 60 }}</p>
    {%- endif -%}
    
    <div class="best-sellers__card-footer">
      <div class="best-sellers__price-wrapper">
        <span class="best-sellers__price-label">Starting at</span>
        <span class="best-sellers__price">{{ lowest_price | money }}</span>
      </div>
    </div>
    
    <a href="{{ product.url }}" class="best-sellers__shop-now">
      SHOP NOW
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
        <path d="M5 12h14M12 5l7 7-7 7"/>
      </svg>
    </a>
  </div>
</div>
