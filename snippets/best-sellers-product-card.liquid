{%- comment -%}
  Best Sellers Product Card
  Clean, minimal design inspired by modern beverage brands
  
  Accepts:
  - product: Product object
  - index: Position in grid
  - section: Section object for settings
{%- endcomment -%}

{%- liquid
  # Find the lowest price across all variants
  assign lowest_price = product.price_min
  
  # Check for badge
  assign badge_text = ''
  for block in section.blocks
    if block.type == 'product_badge' and block.settings.product == product
      assign badge_text = block.settings.badge_text
      break
    endif
  endfor
  
  # Check if product is sold out
  assign is_sold_out = true
  for variant in product.variants
    if variant.available
      assign is_sold_out = false
      break
    endif
  endfor
-%}

<div class="best-sellers__card" data-product-id="{{ product.id }}">
  <a href="{{ product.url }}" class="best-sellers__card-link">
    <!-- Image Container -->
    <div class="best-sellers__card-image">
      {%- if badge_text != blank -%}
        <span class="best-sellers__badge">{{ badge_text }}</span>
      {%- endif -%}
      
      {%- if is_sold_out -%}
        <span class="best-sellers__badge best-sellers__badge--soldout">Sold out</span>
      {%- endif -%}
      
      {%- if product.featured_image != blank -%}
        <img
          src="{{ product.featured_image | image_url: width: 800 }}"
          alt="{{ product.featured_image.alt | escape | default: product.title }}"
          width="{{ product.featured_image.width }}"
          height="{{ product.featured_image.height }}"
          loading="lazy"
          class="best-sellers__product-image"
        >
      {%- else -%}
        <div class="best-sellers__placeholder-image">
          <span>{{ product.title }}</span>
        </div>
      {%- endif -%}
    </div>
    
    <!-- Content -->
    <div class="best-sellers__card-content">
      <h3 class="best-sellers__product-title">{{ product.title }}</h3>
      
      {%- if product.metafields.custom.subheading != blank -%}
        <p class="best-sellers__product-desc">{{ product.metafields.custom.subheading }}</p>
      {%- elsif product.metafields.descriptors.subtitle != blank -%}
        <p class="best-sellers__product-desc">{{ product.metafields.descriptors.subtitle.value }}</p>
      {%- elsif product.description != blank -%}
        <p class="best-sellers__product-desc">{{ product.description | strip_html | truncate: 80 }}</p>
      {%- endif -%}
      
      <div class="best-sellers__price-row">
        <span class="best-sellers__price">{{ lowest_price | money }}</span>
      </div>
    </div>
  </a>
  
  <!-- Shop Now Button -->
  <div class="best-sellers__card-actions">
    <a href="{{ product.url }}" class="best-sellers__shop-now-btn">
      SHOP NOW
    </a>
  </div>
</div>
