{%- comment -%}
  Mobile Sidebar Navigation - Optimized for CRO & UX
  - Clean, modern design matching Happie brand
  - Prominent Shop CTAs
  - Featured collection cards
  - Easy touch navigation
{%- endcomment -%}

{%- assign base_font_class = base_font_class | replace: 'font-heading', 'font-main' -%}

{%- liquid
  # Get accent color from header settings or default
  assign accent_color = section.settings.nav_text_hover_color | default: '#4FB1BD'
  assign text_color = section.settings.nav_text_color | default: '#1A1A1A'
-%}

<template x-teleport="#left-drawer-slot">
  <div
    :data-modal-label="$store.modals.leftDrawer.contents === 'nav' ? '{{ section.settings.main_linklist.title }}' : false"
    x-show="$store.modals.leftDrawer.contents === 'nav'"
    class="sidebar-nav-happie {% if settings.enable_sidebar_nav_animation %} sidebar-nav--enable-transitions {% endif %}"
  >
    {%- comment -%} Header with Close Button {%- endcomment -%}
    <div class="sidebar-nav-happie__header">
      <a href="{{ routes.root_url }}" class="sidebar-nav-happie__logo">
        {%- if section.settings.logo != blank -%}
          <img
            src="{{ section.settings.logo | image_url: width: 120 }}"
            alt="{{ shop.name }}"
            width="120"
            height="auto"
            loading="eager"
          >
        {%- else -%}
          <span class="sidebar-nav-happie__logo-text">{{ shop.name }}</span>
        {%- endif -%}
      </a>
      <button @click.prevent="$store.modals.close('nav')" class="sidebar-nav-happie__close">
        <span class="sr-only">{{ 'general.accessibility.close_modal' | t }}</span>
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M18 6L6 18M6 6l12 12"/>
        </svg>
      </button>
    </div>

    {%- comment -%} Primary CTA - Shop Now {%- endcomment -%}
    <div class="sidebar-nav-happie__cta">
      <a href="/collections/all" class="sidebar-nav-happie__cta-btn">
        Shop All Products
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
          <path d="M5 12h14M12 5l7 7-7 7"/>
        </svg>
      </a>
    </div>

    {%- comment -%} Featured Collection Cards {%- endcomment -%}
    <div class="sidebar-nav-happie__featured">
      <div class="sidebar-nav-happie__featured-grid">
        {%- comment -%} THC Seltzers Card {%- endcomment -%}
        <a href="/collections/thc-seltzers" class="sidebar-nav-happie__featured-card sidebar-nav-happie__featured-card--thc">
          <span class="sidebar-nav-happie__featured-label">THC Infused</span>
          <span class="sidebar-nav-happie__featured-title">Seltzers</span>
        </a>
        
        {%- comment -%} Fungi Fusion Card {%- endcomment -%}
        <a href="/collections/fungi-fusion" class="sidebar-nav-happie__featured-card sidebar-nav-happie__featured-card--fungi">
          <span class="sidebar-nav-happie__featured-label">Zero THC</span>
          <span class="sidebar-nav-happie__featured-title">Fungi Fusion</span>
        </a>
      </div>
    </div>

    {%- comment -%} Navigation Links {%- endcomment -%}
    <nav class="sidebar-nav-happie__nav" aria-label="Main navigation">
      <ul class="sidebar-nav-happie__list">
        {%- liquid
          if section.settings.mobile_main_linklist != blank
            assign menu = section.settings.mobile_main_linklist
          else
            assign menu = section.settings.left_linklist
          endif
        -%}
        
        {%- for link in menu.links -%}
          {%- liquid
            # Skip "Shop" or "Shop All" since we have featured cards above
            assign link_title_downcase = link.title | downcase | strip
            assign skip_link = false
            if link_title_downcase contains 'shop'
              assign skip_link = true
            endif
          -%}
          
          {%- unless skip_link -%}
            <li class="sidebar-nav-happie__item">
              {%- if link.links.size > 0 -%}
                <data-island x-data="{ expanded: false }">
                  <button
                    class="sidebar-nav-happie__link sidebar-nav-happie__link--parent"
                    @click="expanded = !expanded"
                    :aria-expanded="expanded"
                  >
                    <span>{{ link.title }}</span>
                    <svg 
                      class="sidebar-nav-happie__chevron" 
                      :class="{ 'rotate-180': expanded }"
                      width="16" 
                      height="16" 
                      viewBox="0 0 24 24" 
                      fill="none" 
                      stroke="currentColor" 
                      stroke-width="2" 
                      stroke-linecap="round" 
                      stroke-linejoin="round"
                    >
                      <path d="M6 9l6 6 6-6"/>
                    </svg>
                  </button>
                  <ul 
                    class="sidebar-nav-happie__sublist"
                    x-show="expanded" 
                    x-collapse
                  >
                    {%- for child_link in link.links -%}
                      <li>
                        <a href="{{ child_link.url }}" class="sidebar-nav-happie__sublink">
                          {{ child_link.title }}
                        </a>
                      </li>
                    {%- endfor -%}
                  </ul>
                </data-island>
              {%- else -%}
                <a href="{{ link.url }}" class="sidebar-nav-happie__link">
                  {{ link.title }}
                </a>
              {%- endif -%}
            </li>
          {%- endunless -%}
        {%- endfor -%}
      </ul>
    </nav>

    {%- comment -%} Trust Badge / Value Prop {%- endcomment -%}
    <div class="sidebar-nav-happie__trust">
      <div class="sidebar-nav-happie__trust-item">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M5 12l5 5L20 7"/>
        </svg>
        <span>Free Shipping $50+</span>
      </div>
      <div class="sidebar-nav-happie__trust-item">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
        </svg>
        <span>Lab Tested</span>
      </div>
    </div>

    {%- comment -%} Footer Section {%- endcomment -%}
    <div class="sidebar-nav-happie__footer">
      {%- comment -%} Secondary Links {%- endcomment -%}
      {%- if section.settings.sidebar_show_footer_menu -%}
        <nav class="sidebar-nav-happie__secondary" aria-label="Secondary">
          <ul>
            {%- for link in linklists.footer.links -%}
              <li>
                <a href="{{ link.url }}">{{ link.title }}</a>
              </li>
            {%- endfor -%}
          </ul>
        </nav>
      {%- endif -%}

      {%- comment -%} Social Icons {%- endcomment -%}
      {%- if section.settings.sidebar_show_social_icons -%}
        <div class="sidebar-nav-happie__social">
          {%- render 'social-icons', list_class: 'justify-center' -%}
        </div>
      {%- endif -%}
    </div>
  </div>
</template>

<style>
  /* ========================================
     HAPPIE MOBILE NAVIGATION - Premium Design
     ======================================== */
  
  .sidebar-nav-happie {
    display: flex;
    flex-direction: column;
    min-height: 100%;
    padding: 0;
    background: #FFFFFF;
  }
  
  /* Header */
  .sidebar-nav-happie__header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 20px 24px;
    border-bottom: 1px solid rgba(0, 0, 0, 0.06);
  }
  
  .sidebar-nav-happie__logo {
    display: block;
  }
  
  .sidebar-nav-happie__logo img {
    max-width: 100px;
    height: auto;
  }
  
  .sidebar-nav-happie__logo-text {
    font-size: 20px;
    font-weight: 700;
    color: {{ text_color }};
  }
  
  .sidebar-nav-happie__close {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    border: none;
    background: rgba(0, 0, 0, 0.04);
    border-radius: 50%;
    color: {{ text_color }};
    cursor: pointer;
    transition: all 0.2s ease;
  }
  
  .sidebar-nav-happie__close:hover {
    background: rgba(0, 0, 0, 0.08);
  }
  
  /* Primary CTA */
  .sidebar-nav-happie__cta {
    padding: 20px 24px;
  }
  
  .sidebar-nav-happie__cta-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    width: 100%;
    padding: 16px 24px;
    background: {{ accent_color }};
    color: #FFFFFF;
    font-size: 15px;
    font-weight: 700;
    text-decoration: none;
    border-radius: 999px;
    transition: all 0.25s ease;
  }
  
  .sidebar-nav-happie__cta-btn:hover {
    filter: brightness(1.1);
    transform: translateY(-1px);
  }
  
  /* Featured Cards */
  .sidebar-nav-happie__featured {
    padding: 0 24px 24px;
  }
  
  .sidebar-nav-happie__featured-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
  }
  
  .sidebar-nav-happie__featured-card {
    display: flex;
    flex-direction: column;
    justify-content: flex-end;
    padding: 16px;
    min-height: 100px;
    border-radius: 16px;
    text-decoration: none;
    transition: transform 0.25s ease, box-shadow 0.25s ease;
  }
  
  .sidebar-nav-happie__featured-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
  }
  
  .sidebar-nav-happie__featured-card--thc {
    background: linear-gradient(135deg, #E8956D 0%, #D4764A 100%);
    color: #FFFFFF;
  }
  
  .sidebar-nav-happie__featured-card--fungi {
    background: linear-gradient(135deg, #8B7EC8 0%, #6B5CA5 100%);
    color: #FFFFFF;
  }
  
  .sidebar-nav-happie__featured-label {
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    opacity: 0.85;
    margin-bottom: 2px;
  }
  
  .sidebar-nav-happie__featured-title {
    font-size: 18px;
    font-weight: 800;
  }
  
  /* Navigation List */
  .sidebar-nav-happie__nav {
    flex: 1;
    padding: 8px 0;
    border-top: 1px solid rgba(0, 0, 0, 0.06);
  }
  
  .sidebar-nav-happie__list {
    list-style: none;
    margin: 0;
    padding: 0;
  }
  
  .sidebar-nav-happie__item {
    border-bottom: 1px solid rgba(0, 0, 0, 0.04);
  }
  
  .sidebar-nav-happie__link {
    display: flex;
    align-items: center;
    justify-content: space-between;
    width: 100%;
    padding: 16px 24px;
    font-size: 16px;
    font-weight: 600;
    color: {{ text_color }};
    text-decoration: none;
    background: transparent;
    border: none;
    cursor: pointer;
    transition: background 0.2s ease;
  }
  
  .sidebar-nav-happie__link:hover,
  .sidebar-nav-happie__link:focus {
    background: rgba(0, 0, 0, 0.02);
  }
  
  .sidebar-nav-happie__chevron {
    transition: transform 0.25s ease;
    color: rgba(0, 0, 0, 0.4);
  }
  
  .sidebar-nav-happie__chevron.rotate-180 {
    transform: rotate(180deg);
  }
  
  /* Sublist */
  .sidebar-nav-happie__sublist {
    list-style: none;
    margin: 0;
    padding: 0 0 12px 0;
    background: rgba(0, 0, 0, 0.02);
  }
  
  .sidebar-nav-happie__sublink {
    display: block;
    padding: 12px 24px 12px 40px;
    font-size: 15px;
    font-weight: 500;
    color: rgba(0, 0, 0, 0.7);
    text-decoration: none;
    transition: color 0.2s ease;
  }
  
  .sidebar-nav-happie__sublink:hover {
    color: {{ accent_color }};
  }
  
  /* Trust Badges */
  .sidebar-nav-happie__trust {
    display: flex;
    justify-content: center;
    gap: 24px;
    padding: 20px 24px;
    background: rgba(0, 0, 0, 0.02);
    border-top: 1px solid rgba(0, 0, 0, 0.06);
  }
  
  .sidebar-nav-happie__trust-item {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 12px;
    font-weight: 600;
    color: rgba(0, 0, 0, 0.6);
  }
  
  .sidebar-nav-happie__trust-item svg {
    color: {{ accent_color }};
  }
  
  /* Footer */
  .sidebar-nav-happie__footer {
    padding: 20px 24px;
    border-top: 1px solid rgba(0, 0, 0, 0.06);
  }
  
  .sidebar-nav-happie__secondary ul {
    list-style: none;
    margin: 0;
    padding: 0;
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 8px 16px;
  }
  
  .sidebar-nav-happie__secondary a {
    font-size: 13px;
    color: rgba(0, 0, 0, 0.5);
    text-decoration: none;
    transition: color 0.2s ease;
  }
  
  .sidebar-nav-happie__secondary a:hover {
    color: {{ accent_color }};
  }
  
  .sidebar-nav-happie__social {
    margin-top: 16px;
    display: flex;
    justify-content: center;
  }
  
  .sidebar-nav-happie__social a {
    color: rgba(0, 0, 0, 0.4);
    transition: color 0.2s ease;
  }
  
  .sidebar-nav-happie__social a:hover {
    color: {{ accent_color }};
  }
</style>
